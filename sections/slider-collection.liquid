{%- liquid
  if hide_product_information
    assign show_rating = false
    assign show_vendor = false
    assign show_title = false
    assign show_prices = false
  else
    assign show_rating = show_rating | default: settings.show_product_rating, allow_false: true
    assign show_vendor = show_vendor | default: settings.show_vendor, allow_false: true
    assign show_title = true
    assign show_prices = true
  endif
-%}

<section class="color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
  <div class="container page-width">
    <div class="slider-title">
      {% if section.settings.heading != blank %}
        <h2 class="section-heading">{{ section.settings.heading }}</h2>
      {% endif %}
    </div>

    {% if section.settings.subheading != blank %}
      <p class="section-subheading">{{ section.settings.subheading }}</p>
    {% endif %}

    <!-- Tabs -->
    <div class="tab-buttons">
      {% for block in section.blocks %}
        <button class="tab-button" data-tab="{{ block.id }}">{{ block.settings.label }}</button>
      {% endfor %}
    </div>

    <!-- Sliders -->
    {% for block in section.blocks %}
      {% assign collection = collections[block.settings.collection] %}
      <div class="product-slider-wrapper" data-tab="{{ block.id }}" {% unless forloop.first %}style="display:none"{% endunless %}>
        {% if collection.products.size > 0 %}
          <div class="splide" id="splide-{{ block.id }}">
            <div class="splide__track">
              <ul class="splide__list">
                {% for product in collection.products %}
                  <li class="splide__slide">
                    <a href="{{ product.url }}" class="product-card" style="text-decoration: none;">
                      <div class="product-card__image-wrapper" style="position: relative;">
                        <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                      <div>
                        <h3 class="product-card__title">{{ product.title }}</h3>
                        <div class="product-card__price">
                          {% if product.compare_at_price > product.price %}
                            from <span class="product-card__price--sale">{{ product.price | money }}</span>
                          {% else %}
                            from <span class="product-card__price--regular">{{ product.price | money }}</span>
                          {% endif %}
                        </div>
                        {%- if show_rating -%}
                          {%- render 'product-rating', show_placeholder: true, display_mode: settings.product_rating_mode -%}
                        {%- endif -%}
                        <p></p>
                      </div>
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% else %}
          <p>No products in {{ block.settings.label }}.</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</section>


{% schema %}
{
  "name": "Tabbed Slider",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Explore Our Collections"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Choose a category to explore products"
    }
  ],
  "blocks": [
    {
      "type": "collection_tab",
      "name": "Collection Tab",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Tab Label",
          "default": "Adjustable Beds"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tabbed Collection Slider",
      "category": "Custom",
      "blocks": [
        {
          "type": "collection_tab",
          "settings": {
            "label": "Adjustable Beds"
          }
        },
        {
          "type": "collection_tab",
          "settings": {
            "label": "Mattresses"
          }
        }
      ]
    }
  ]
}
{% endschema %}
